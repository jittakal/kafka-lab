apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "kafeventproducer.fullname" . }}-config
  labels:
    {{- include "kafeventproducer.labels" . | nindent 4 }}
data:
  application.yaml: |
    # Kafka Configuration
    kafka:
      brokers:
        {{- range .Values.kafka.brokers }}
        - {{ . | quote }}
        {{- end }}
      securityProtocol: {{ .Values.kafka.security.protocol | quote }}
      saslMechanism: {{ .Values.kafka.security.sasl.mechanism | quote }}
      saslUsername: {{ .Values.kafka.security.sasl.username | quote }}
      saslPassword: "${KAFKA_SASL_PASSWORD}"
      
      tls:
        enabled: {{ .Values.kafka.security.tls.enabled }}
        insecureSkipVerify: {{ .Values.kafka.security.tls.insecureSkipVerify }}
      
      producer:
        requiredAcks: {{ .Values.kafka.producer.requiredAcks }}
        compressionType: {{ .Values.kafka.producer.compressionType | quote }}
        maxMessageBytes: {{ .Values.kafka.producer.maxMessageBytes }}
        idempotentWrites: {{ .Values.kafka.producer.idempotentWrites }}
        retryMax: {{ .Values.kafka.producer.retryMax }}
        retryBackoffMs: {{ .Values.kafka.producer.retryBackoffMs }}
      
      awsMsk:
        enabled: {{ .Values.kafka.awsMsk.enabled }}
        {{- if .Values.kafka.awsMsk.region }}
        region: {{ .Values.kafka.awsMsk.region | quote }}
        {{- end }}
    
    # Topic Configuration
    topics:
      bookIssued: {{ .Values.topics.bookIssued | quote }}
      bookReturned: {{ .Values.topics.bookReturned | quote }}
    
    # Event Generator Configuration
    generator:
      intervalMs: {{ .Values.generator.intervalMs }}
      
      bookIssued:
        enabled: {{ .Values.generator.bookIssued.enabled }}
        probability: {{ .Values.generator.bookIssued.probability }}
      
      bookReturned:
        enabled: {{ .Values.generator.bookReturned.enabled }}
        probability: {{ .Values.generator.bookReturned.probability }}
